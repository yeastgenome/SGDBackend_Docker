-- Generated by Ora2Pg, the Oracle database Schema converter, version 17.4
-- Copyright 2000-2016 Gilles DAROLD. All rights reserved.
-- DATASOURCE: dbi:Oracle:host=sgd-nex2-db.stanford.edu;sid=SGD

SET client_encoding TO 'UTF8';

\set ON_ERROR_STOP ON


--
-- Generates the numeric portion of a SGDID
--
CREATE OR REPLACE FUNCTION makesgdid () RETURNS varchar AS $body$
DECLARE

    v_Sgdid	nex.dbentity.sgdid%TYPE;
    v_SgdidNo   text;

BEGIN

   SELECT nextval('nex.sgdid_seq') INTO v_SgdidNo ;

   IF (length(v_SgdidNo) = 9) THEN
        v_Sgdid := CONCAT('S',v_SgdidNo);
        RETURN (v_Sgdid);
   ELSIF (length(v_SgdidNo) = 8) THEN
        v_Sgdid := CONCAT('S0',v_SgdidNo);
        RETURN (v_Sgdid);
   ELSIF (length(v_SgdidNo) = 7) THEN
        v_Sgdid := CONCAT('S00',v_SgdidNo);
        RETURN (v_Sgdid);
   ELSIF (length(v_SgdidNo) = 6) THEN
        v_Sgdid := CONCAT('S000',v_SgdidNo);
        RETURN (v_Sgdid);
   ELSIF (length(v_SgdidNo) = 5) THEN
        v_Sgdid := CONCAT('S0000',v_SgdidNo);
        RETURN (v_Sgdid);
   ELSIF (length(v_SgdidNo) = 4) THEN
        v_Sgdid := CONCAT('S00000',v_SgdidNo);
        RETURN (v_Sgdid);
   ELSIF (length(v_SgdidNo) = 3) THEN
        v_Sgdid := CONCAT('S000000',v_SgdidNo);
        RETURN (v_Sgdid);
   ELSIF (length(v_SgdidNo) = 2) THEN
        v_Sgdid := CONCAT('S0000000',v_SgdidNo);
        RETURN (v_Sgdid);
   ELSIF (length(v_SgdidNo) = 1) THEN
        v_Sgdid := CONCAT('S00000000',v_SgdidNo);
        RETURN (v_Sgdid);
   ELSE
        RAISE EXCEPTION 'Invalid Sequence No: "%"', v_SgdidNo ;
   END IF;

END;
$body$ LANGUAGE PLPGSQL
       SECURITY DEFINER
       SET search_path = nex, pg_temp;
GRANT EXECUTE on FUNCTION makesgdid () to CURATOR;
REVOKE ALL ON FUNCTION makesgdid () FROM PUBLIC;
